Archivos del proyecto:
======================
lib/firebase_options.dart
--- File: lib/firebase_options.dart ---
// File generated by FlutterFire CLI.
// ignore_for_file: type=lint
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        return windows;
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyAQlbZbAtT6vTCY191Qlh0axLmcWSds05s',
    appId: '1:1046204540356:web:1af2be11bc20a4ab82f091',
    messagingSenderId: '1046204540356',
    projectId: 'app-homero-flutter',
    authDomain: 'app-homero-flutter.firebaseapp.com',
    storageBucket: 'app-homero-flutter.firebasestorage.app',
    measurementId: 'G-YG5MQYHF3S',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyCmN2GfPw3MtQQ0simtxiBZXekpEmNXeWc',
    appId: '1:1046204540356:android:977ea8692a56ddce82f091',
    messagingSenderId: '1046204540356',
    projectId: 'app-homero-flutter',
    storageBucket: 'app-homero-flutter.firebasestorage.app',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyAnlMa6AARAt1A375b7oXRjGkBF1kScwwg',
    appId: '1:1046204540356:ios:33825262b27181bf82f091',
    messagingSenderId: '1046204540356',
    projectId: 'app-homero-flutter',
    storageBucket: 'app-homero-flutter.firebasestorage.app',
    iosBundleId: 'com.example.proyectoHomero',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'AIzaSyAnlMa6AARAt1A375b7oXRjGkBF1kScwwg',
    appId: '1:1046204540356:ios:33825262b27181bf82f091',
    messagingSenderId: '1046204540356',
    projectId: 'app-homero-flutter',
    storageBucket: 'app-homero-flutter.firebasestorage.app',
    iosBundleId: 'com.example.proyectoHomero',
  );

  static const FirebaseOptions windows = FirebaseOptions(
    apiKey: 'AIzaSyAQlbZbAtT6vTCY191Qlh0axLmcWSds05s',
    appId: '1:1046204540356:web:8f8e5a64ad7ef7f682f091',
    messagingSenderId: '1046204540356',
    projectId: 'app-homero-flutter',
    authDomain: 'app-homero-flutter.firebaseapp.com',
    storageBucket: 'app-homero-flutter.firebasestorage.app',
    measurementId: 'G-V1M1RVKSJH',
  );
}

lib/main.dart
--- File: lib/main.dart ---
import 'dart:io' show Platform;
import 'package:flutter/cupertino.dart';
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';
import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:proyecto_homero/data/datasources/beer_remote_datasource.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:proyecto_homero/presentation/blocs/beer_counter/beer_counter_bloc.dart';
import 'package:proyecto_homero/presentation/services/notification_service.dart';
import 'package:proyecto_homero/presentation/services/settings_service.dart';
import 'presentation/blocs/cart/cart_bloc.dart';
import 'presentation/blocs/cart/cart_event.dart';
import 'data/repositories/beer_repository_impl.dart';
import 'domain/repositories/beer_repository.dart';
import 'presentation/screens/settings_page.dart';
import 'presentation/screens/beer_menu_screen.dart';
import 'presentation/screens/favorites_page.dart';
import 'presentation/screens/extras_page.dart';

Future<void> main() async {
  // Asegura que los bindings de Flutter est칠n inicializados antes de cualquier otra cosa.
  WidgetsFlutterBinding.ensureInitialized();
  // Inicializa Firebase usando las opciones generadas por FlutterFire CLI.
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  // Inicializamos nuestro servicio de notificaciones
  await NotificationService().init();

  // Comprobamos si el recordatorio debe estar activo al iniciar
  final settingsService = SettingsService();
  if (await settingsService.getWaterReminder()) {
    await NotificationService().scheduleHourlyWaterReminder();
  }
  runApp(const TabernadeMoeApp());
}

class TabernadeMoeApp extends StatelessWidget {
  const TabernadeMoeApp({super.key});

  @override
  Widget build(BuildContext context) {
    return RepositoryProvider<BeerRepository>(
      create: (context) => BeerRepositoryImpl(
        remoteDataSource: BeerRemoteDataSourceImpl(
          // Le pasamos la instancia de Firestore
          firestore: FirebaseFirestore.instance,
        ),
      ),
      child: MultiBlocProvider(
        providers: [
          BlocProvider(
            create: (context) => CartBloc(
              beerRepository: context.read<BeerRepository>(),
            )..add(CartProductsLoaded()),
          ),
          BlocProvider(create: (context) => BeerCounterBloc()),
        ],
        child: MaterialApp(
          title: 'La App de la Taberna de Moe',
          theme: ThemeData(
            primarySwatch: Colors.yellow,
            textTheme: Platform.isIOS
                ? TextTheme(
                    bodyMedium: CupertinoThemeData().textTheme.textStyle.copyWith(
                      fontSize: 16,
                    ),
                  )
                : null,
            visualDensity: VisualDensity.adaptivePlatformDensity,
          ),
          home: const AdaptiveNavigationScaffold(),
        ),
      ),
    );
  }
}

class AppNavItem {
  final IconData icon;
  final String label;
  final Widget page;

  const AppNavItem({
    required this.icon,
    required this.label,
    required this.page,
  });
}

final List<AppNavItem> mainNavItems = [
  const AppNavItem(icon: Icons.local_bar, label: 'Men칰 Duff', page: BeerMenuScreen()),
  AppNavItem(icon: Icons.favorite, label: 'Favoritos', page: FavoritesPage()),
  AppNavItem(icon: Icons.star, label: 'Extras', page: ExtrasPage()),
  const AppNavItem(icon: Icons.settings, label: 'Configuraci칩n', page: SettingsPage()),
];

class AdaptiveNavigationScaffold extends StatefulWidget {
  const AdaptiveNavigationScaffold({super.key});

  @override
  State<AdaptiveNavigationScaffold> createState() => _AdaptiveNavigationScaffoldState();
}

class _AdaptiveNavigationScaffoldState extends State<AdaptiveNavigationScaffold> {
  int _selectedIndex = 0;

  @override
  Widget build(BuildContext context) {
    final isCompact = MediaQuery.of(context).size.width < 600;

    return Scaffold(
      appBar: AppBar(
        title: Text(mainNavItems[_selectedIndex].label),
        backgroundColor: Colors.yellow[800],
        foregroundColor: Colors.black,
      ),
      body: Row(
        children: [
          if (!isCompact)
            NavigationRail(
              backgroundColor: Colors.yellow[700],
              selectedIndex: _selectedIndex,
              onDestinationSelected: (index) => setState(() => _selectedIndex = index),
              labelType: NavigationRailLabelType.all,
              destinations: mainNavItems
                  .map(
                    (item) => NavigationRailDestination(
                      icon: Icon(item.icon),
                      label: Text(item.label),
                    ),
                  )
                  .toList(),
            ),
          Expanded(child: mainNavItems[_selectedIndex].page),
        ],
      ),
      bottomNavigationBar: isCompact
          ? BottomNavigationBar(
              type: BottomNavigationBarType.fixed,
              currentIndex: _selectedIndex,
              onTap: (index) => setState(() => _selectedIndex = index),
              items: mainNavItems
                  .map(
                    (item) => BottomNavigationBarItem(
                      icon: Icon(item.icon),
                      label: item.label,
                    ),
                  )
                  .toList(),
              selectedItemColor: Colors.black,
              backgroundColor: Colors.yellow[700],
            )
          : null,
    );
  }
}
lib/presentation/screens/extras_page.dart
--- File: lib/presentation/screens/extras_page.dart ---
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'dart:io' show Platform;
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:audioplayers/audioplayers.dart';
// para agregar map_screen al proyecto
import 'package:proyecto_homero/presentation/screens/map_screen.dart';
import '../blocs/beer_counter/beer_counter_bloc.dart';
import '../blocs/beer_counter/beer_counter_event.dart';
import '../blocs/beer_counter/beer_counter_state.dart';

// Extras con el switch y contador de cervezas
class ExtrasPage extends StatelessWidget {
  const ExtrasPage({super.key});

  // --- NUEVA FUNCI칍N PARA MOSTRAR LA ALERTA ---
  void _mostrarAlertaHomero(BuildContext context) {
    //Reproduce el sonido justo antes de mostrar la alerta
    final player = AudioPlayer();
    player.play(AssetSource('sounds/marge.mp3'));

    showDialog(
      context: context,
      builder: (BuildContext context) {
        return AlertDialog(
          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
          title: Text(
            "춰D'oh!",
            style: TextStyle(fontWeight: FontWeight.bold),
          ),
          content: Column(
            mainAxisSize: MainAxisSize.min, // Para que la columna no ocupe toda la pantalla
            children: [
              // Puedes cambiar la URL por una imagen local si la agregas a tus assets
              Image.asset(
                'assets/marge.png', // Imagen de Marge enojada
                height: 220,
                // --- NUEVO C칍DIGO DE DIAGN칍STICO A칌ADIDO AQU칈 ---
                errorBuilder: (BuildContext context, Object error, StackTrace? stackTrace) {
                  // Si hay un error, en lugar de la imagen, muestra este texto.
                  return Text(
                    'Error al cargar la imagen. Raz칩n: $error',
                    textAlign: TextAlign.center,
                    style: TextStyle(color: Colors.red),
                  );
                },
                // --- FIN DEL C칍DIGO DE DIAGN칍STICO ---
              ),
              SizedBox(height: 20),
              Text(
                "Hmmm Homero!",
                style: TextStyle(fontSize: 18),
                textAlign: TextAlign.center,
              ),
            ],
          ),
          actions: <Widget>[
            TextButton(
              child: Text("Cerrar"),
              onPressed: () {
                Navigator.of(context).pop(); // Cierra el di치logo
              },
            ),
          ],
        );
      },
    );
  }


  @override
  Widget build(BuildContext context) {
    // Usamos BlocListener para efectos secundarios (como mostrar un di치logo)
    // y BlocBuilder para construir la UI.
    return BlocListener<BeerCounterBloc, BeerCounterState>(
      listener: (context, state) {
        // Si el estado indica que se debe mostrar la alerta, la mostramos.
        if (state.showHomerAlert) {
          _mostrarAlertaHomero(context);
        }
      },
      child: BlocBuilder<BeerCounterBloc, BeerCounterState>(
        builder: (context, state) {
          return ListView(
            padding: EdgeInsets.all(16),
            children: [
              Text(
                'Extras de Homero 游꼴游꽄',
                style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
              ),
              SizedBox(height: 20),

              // Switch estilo "bot칩n" adaptativo
              Card(
                color: Colors.yellow[100],
                elevation: 3,
                margin: const EdgeInsets.symmetric(vertical: 8),
                child: ListTile(
                  leading: Icon(Icons.settings, color: Colors.yellow[800]),
                  title: Text(
                    'Activar contador de cervezas 游꽄',
                    style: TextStyle(
                      fontSize: Platform.isIOS ? 16 : 18,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  trailing: Switch.adaptive(
                    value: state.isActive,
                    onChanged: (value) {
                      context.read<BeerCounterBloc>().add(BeerCounterToggled(value));
                    },
                  ),
                ),
              ),

              SizedBox(height: 20),

              if (state.isActive) ...[
                Text(
                  'Cervezas consumidas hoy: ${state.beerCount}',
                  style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                ),
                SizedBox(height: 10),
                ElevatedButton.icon(
                  style: ElevatedButton.styleFrom(
                    backgroundColor: Colors.yellow[700],
                    foregroundColor: Colors.black,
                  ),
                  icon: Icon(Icons.add),
                  label: Text("Agregar una Duff"),
                  onPressed: () {
                    // La 칰nica responsabilidad del bot칩n es despachar el evento.
                    context.read<BeerCounterBloc>().add(BeerCounterIncremented());
                  },
                ),
                SizedBox(height: 20),
              ],

              Card(
                color: Colors.yellow[100],
                elevation: 3,
                margin: const EdgeInsets.symmetric(vertical: 8),
                child: ListTile(
                  leading: Icon(Icons.settings, color: Colors.yellow[800]),
                  title: Text(
                    'Descuentos especiales',
                    style: TextStyle(
                      fontSize: Platform.isIOS ? 16 : 18,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                ),
              ),

              // --- Bot칩n para el Mapa ---
              Card(
                color: Colors.yellow[100],
                elevation: 3,
                margin: const EdgeInsets.symmetric(vertical: 8),
                child: ListTile(
                  leading: Icon(Icons.map, color: Colors.yellow[800]),
                  title: Text(
                    'Ver Mapa',
                    style: TextStyle(
                      fontSize: Platform.isIOS ? 16 : 18,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  trailing: Icon(Icons.arrow_forward_ios, color: Colors.yellow[800]),
                  onTap: () {
                    Navigator.push(
                      context,
                      MaterialPageRoute(builder: (context) => const MapScreen()),
                    );
                  },
                ),
              ),
              // --- FIN: Bot칩n para el Mapa --
            ],
          );
        },
      ),
    );
  }
}

lib/presentation/screens/orders_page.dart
--- File: lib/presentation/screens/orders_page.dart ---
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:intl/intl.dart';
import '../../data/repositories/order_repository_impl.dart';
import '../../domain/entities/favorite_order.dart';
import '../../domain/entities/order.dart';
import '../blocs/orders/orders_bloc.dart';
import '../blocs/orders/orders_event.dart';
import '../blocs/orders/orders_state.dart';

class OrdersPage extends StatelessWidget {
  const OrdersPage({super.key});

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (context) =>
          OrdersBloc(orderRepository: MockOrderRepository())..add(OrdersLoaded()),
      child: Scaffold(
        appBar: AppBar(
          title: const Text('Mis Pedidos', style: TextStyle(color: Colors.black)),
          backgroundColor: Colors.yellow[700],
        ),
        body: BlocBuilder<OrdersBloc, OrdersState>(
          builder: (context, state) {
            if (state is OrdersLoading) {
              return const Center(child: CircularProgressIndicator());
            }
            if (state is OrdersLoadSuccess) {
              return _buildOrdersList(context, state);
            }
            if (state is OrdersError) {
              return Center(child: Text(state.message));
            }
            return const Center(child: Text("Algo sali칩 mal."));
          },
        ),
      ),
    );
  }

  Widget _buildOrdersList(BuildContext context, OrdersLoadSuccess state) {
    return ListView(
      padding: const EdgeInsets.all(16.0),
      children: [
        _buildSectionTitle('Favoritos'),
        ...state.favoriteOrders.map((fav) => _buildFavoriteCard(context, fav)),
        const SizedBox(height: 24),
        _buildSectionTitle('Pedidos'),
        ...state.activeOrders.map((order) => _buildOrderCard(context, order)),
      ],
    );
  }

  Widget _buildSectionTitle(String title) {
    return Padding(
      padding: const EdgeInsets.only(bottom: 8.0),
      child: Text(
        title,
        style: const TextStyle(fontSize: 22, fontWeight: FontWeight.bold),
      ),
    );
  }

  Widget _buildFavoriteCard(BuildContext context, FavoriteOrder favorite) {
    return Card(
      elevation: 2,
      margin: const EdgeInsets.symmetric(vertical: 8),
      child: ListTile(
        leading: CircleAvatar(
          backgroundColor: Colors.yellow[700],
          child: Text(
            '#${favorite.id}',
            style: const TextStyle(color: Colors.black, fontWeight: FontWeight.bold),
          ),
        ),
        title: const Text('Pedido Favorito'),
        subtitle: Text('${favorite.totalItems} productos'),
        trailing: const Icon(Icons.chevron_right),
        onTap: () => _showFavoriteDrawer(context, favorite),
      ),
    );
  }

  Widget _buildOrderCard(BuildContext context, Order order) {
    return Card(
      elevation: 2,
      margin: const EdgeInsets.symmetric(vertical: 8),
      child: ListTile(
        leading: Icon(
          order.status == OrderStatus.llegando ? Icons.delivery_dining : Icons.receipt_long,
          color: Colors.blueAccent,
        ),
        title: Text('Pedido del ${DateFormat('dd/MM/yyyy HH:mm').format(order.date)}'),
        subtitle: Text('${order.totalItems} productos - ${order.statusText}'),
        trailing: const Icon(Icons.chevron_right),
        onTap: () => _showOrderDrawer(context, order),
      ),
    );
  }

  void _showFavoriteDrawer(BuildContext context, FavoriteOrder favorite) {
    // Usamos un Builder para obtener un nuevo context que pueda encontrar el Scaffold
    showModalBottomSheet(
        context: context,
        isScrollControlled: true,
        builder: (ctx) {
          return DraggableScrollableSheet(
              expand: false,
              initialChildSize: 0.5,
              builder: (_, controller) => Container(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    Text('Favorito #${favorite.id}', style: Theme.of(context).textTheme.headlineSmall),
                    const Divider(),
                    Expanded(
                      child: ListView.builder(
                        controller: controller,
                        itemCount: favorite.items.length,
                        itemBuilder: (c, i) => ListTile(
                          title: Text(favorite.items[i].name),
                          trailing: Text('x${favorite.items[i].quantity}'),
                        ),
                      ),
                    ),
                    SizedBox(
                      width: double.infinity,
                      child: ElevatedButton.icon(
                        icon: const Icon(Icons.repeat),
                        label: const Text('Repetir Pedido'),
                        onPressed: () {
                          context.read<OrdersBloc>().add(OrderRepeated(favorite));
                          Navigator.of(ctx).pop(); // Cierra el bottom sheet
                          ScaffoldMessenger.of(context).showSnackBar(
                            const SnackBar(content: Text('Pedido a침adido a la lista!'), backgroundColor: Colors.green),
                          );
                        },
                      ),
                    )
                  ],
                ),
              ));
        });
  }

  void _showOrderDrawer(BuildContext context, Order order) {
    showModalBottomSheet(
        context: context,
        isScrollControlled: true,
        builder: (ctx) {
          return DraggableScrollableSheet(
              expand: false,
              initialChildSize: 0.6,
              builder: (_, controller) => Container(
                padding: const EdgeInsets.all(16),
                child: Column(
                  children: [
                    Text('Detalles del Pedido', style: Theme.of(context).textTheme.headlineSmall),
                    const Divider(),
                    Expanded(
                      child: ListView.builder(
                        controller: controller,
                        itemCount: order.items.length,
                        itemBuilder: (c, i) => ListTile(
                          title: Text(order.items[i].name),
                          trailing: Text('x${order.items[i].quantity}'),
                        ),
                      ),
                    ),
                    const Divider(),
                    Text('Estado: ${order.statusText}', style: const TextStyle(fontSize: 16, fontWeight: FontWeight.bold)),
                    const SizedBox(height: 16),
                    Row(
                      mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                      children: [
                        ElevatedButton(
                          style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
                          child: const Text('Cancelar Pedido'),
                          onPressed: order.status == OrderStatus.cancelado ? null : () {
                            context.read<OrdersBloc>().add(OrderStatusChanged(order.id, OrderStatus.cancelado));
                            Navigator.of(ctx).pop();
                          },
                        ),
                        ElevatedButton(
                          style: ElevatedButton.styleFrom(backgroundColor: Colors.green),
                          child: const Text('Confirmar Entrega'),
                          onPressed: order.status == OrderStatus.entregado ? null : () {
                             context.read<OrdersBloc>().add(OrderStatusChanged(order.id, OrderStatus.entregado));
                             Navigator.of(ctx).pop();
                          },
                        ),
                      ],
                    )
                  ],
                ),
              ));
        });
  }
}

lib/presentation/screens/beer.dart
--- File: lib/presentation/screens/beer.dart ---
import 'package:equatable/equatable.dart';

class Beer extends Equatable {
  final String id; // <-- CAMBIO: A침adido
  final String name;
  final double price;
  final String image;
  final int quantity;

  const Beer({
    required this.id, // <-- CAMBIO: A침adido
    required this.name,
    required this.price,
    required this.image,
    this.quantity = 0,
  });

  Beer copyWith({
    String? id,
    String? name,
    double? price,
    String? image,
    int? quantity,
  }) {
    return Beer(
      id: id ?? this.id,
      name: name ?? this.name,
      price: price ?? this.price,
      image: image ?? this.image,
      quantity: quantity ?? this.quantity,
    );
  }

  @override
  List<Object?> get props => [id, name, price, image, quantity];
}

lib/presentation/screens/settings_page.dart
--- File: lib/presentation/screens/settings_page.dart ---
import 'dart:io' show Platform;
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:proyecto_homero/presentation/services/notification_service.dart';
import 'package:proyecto_homero/presentation/services/settings_service.dart';

class SettingsPage extends StatefulWidget {
  const SettingsPage({super.key});

  @override
  State<SettingsPage> createState() => _SettingsPageState();
}

class _SettingsPageState extends State<SettingsPage> {
  String _selectedLanguage = 'Espa침ol'; // idioma inicial
  bool _waterReminderActive = false; // Estado para el recordatorio
  final NotificationService _notificationService = NotificationService();
  final SettingsService _settingsService = SettingsService();

  @override
  void initState() {
    super.initState();
    _loadSettings();
  }

  Future<void> _loadSettings() async {
    final isActive = await _settingsService.getWaterReminder();
    setState(() {
      _waterReminderActive = isActive;
    });
  }

  @override
  Widget build(BuildContext context) {
    final List<String> settingsOptions = [
      'Notificaciones',
      'Sonido de pedido listo',
      'Recordatorio de beber agua',
      'Idioma',
      'Tema claro/oscuro',
    ];

    return ListView.builder(
      padding: const EdgeInsets.all(16),
      itemCount: settingsOptions.length,
      itemBuilder: (context, index) {
        final option = settingsOptions[index];

        // --- NUEVO: Caso para el recordatorio de agua ---
        if (option == 'Recordatorio de beber agua') {
          return Card(
            color: Colors.yellow[100],
            elevation: 3,
            margin: const EdgeInsets.symmetric(vertical: 8),
            child: ListTile(
              leading: Icon(Icons.opacity, color: Colors.blue[400]),
              title: Text(
                option,
                style: TextStyle(
                  fontSize: Platform.isIOS ? 16 : 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              trailing: Switch.adaptive(
                value: _waterReminderActive,
                onChanged: _onWaterReminderChanged,
                activeColor: Colors.blue,
              ),
            ),
          );
        }

        // Si es el 칤tem "Idioma", hacemos un ListTile especial
        if (option == 'Idioma') {
          return Card(
            color: Colors.yellow[100],
            elevation: 3,
            margin: const EdgeInsets.symmetric(vertical: 8),
            child: ListTile(
              leading: Icon(Icons.language, color: Colors.yellow[800]),
              title: Text(
                '$option: $_selectedLanguage',
                style: TextStyle(
                  fontSize: Platform.isIOS ? 16 : 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              onTap: () => _showLanguageMenu(context), // abre el men칰
            ),
          );
        }

        // ListTile normal para otros 칤tems
        return Card(
          color: Colors.yellow[100],
          elevation: 3,
          margin: const EdgeInsets.symmetric(vertical: 8),
          child: ListTile(
            leading: Icon(Icons.settings, color: Colors.yellow[800]),
            title: Text(
              option,
              style: TextStyle(
                fontSize: Platform.isIOS ? 16 : 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            trailing: Platform.isIOS
                ? CupertinoSwitch(value: false, onChanged: (val) {}, activeColor: Colors.yellow[800])
                : Switch(value: false, onChanged: (val) {}, activeColor: Colors.yellow[800]),
          ),
        );
      },
    );
  }

  // --- NUEVO: M칠todo para manejar el cambio del switch ---
  void _onWaterReminderChanged(bool value) {
    setState(() {
      _waterReminderActive = value;
    });
    if (value) {
      // Si se activa, programamos la notificaci칩n
      _notificationService.scheduleHourlyWaterReminder();
      _settingsService.setWaterReminder(true);
    } else {
      // Si se desactiva, cancelamos todas las notificaciones programadas
      _notificationService.cancelAllNotifications();
      _settingsService.setWaterReminder(false);
    }
  }


  void _showLanguageMenu(BuildContext context) {
    showModalBottomSheet(
      context: context,
      builder: (_) {
        final languages = ['Espa침ol', 'Ingl칠s', 'El de Lisa'];
        return ListView.builder(
          itemCount: languages.length,
          itemBuilder: (context, index) {
            final lang = languages[index];
            return ListTile(
              title: Text(lang),
              onTap: () {
                setState(() {
                  _selectedLanguage = lang;
                });
                Navigator.pop(context); // cierra el bottom sheet
              },
            );
          },
        );
      },
    );
  }
}

lib/presentation/screens/map_screen.dart
--- File: lib/presentation/screens/map_screen.dart ---
import 'package:flutter/material.dart';

// 1. Convertido a StatefulWidget
class MapScreen extends StatefulWidget {
  const MapScreen({super.key});

  @override
  State<MapScreen> createState() => _MapScreenState();
}

class _MapScreenState extends State<MapScreen> {
  // 2. Controlador para manipular el InteractiveViewer
  final TransformationController _transformationController = TransformationController();

  // Constantes para el zoom
  final double _minScale = 0.5;
  final double _maxScale = 4.0;

  @override
  void dispose() {
    _transformationController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Mapa de Springfield', style: TextStyle(color: Colors.black)),
        backgroundColor: Colors.yellow[700],
        iconTheme: const IconThemeData(color: Colors.black),
      ),
      backgroundColor: Colors.grey[850],
      // 3. Usamos un Stack para poner los botones sobre el mapa
      body: Stack(
        children: [
          Center(
            child: InteractiveViewer(
              // 4. Conectamos el controlador
              transformationController: _transformationController,
              panEnabled: true,
              boundaryMargin: const EdgeInsets.all(20),
              minScale: _minScale,
              maxScale: _maxScale,
              child: Image.asset(
                'assets/mapa_springfield.jpg', // Reemplaza con el nombre de tu imagen
              ),
            ),
          ),
          // 5. Posicionamos los botones de zoom
          Positioned(
            bottom: 20,
            right: 20,
            child: Column(
              children: [
                FloatingActionButton(
                  heroTag: 'zoomIn', // Tag 칰nico para el Hero
                  mini: true,
                  backgroundColor: Colors.yellow[700],
                  child: const Icon(Icons.add, color: Colors.black),
                  onPressed: () {
                    // L칩gica para hacer zoom in
                    final currentScale = _transformationController.value.getMaxScaleOnAxis();
                    final newScale = (currentScale * 1.2).clamp(_minScale, _maxScale);
                    final zoomedMatrix = Matrix4.identity()
                      ..translate(context.size!.width / 2, context.size!.height / 2)
                      ..scale(newScale)
                      ..translate(-context.size!.width / 2, -context.size!.height / 2);

                    _transformationController.value = zoomedMatrix;
                  },
                ),
                const SizedBox(height: 8),
                FloatingActionButton(
                  heroTag: 'zoomOut', // Tag 칰nico para el Hero
                  mini: true,
                  backgroundColor: Colors.yellow[700],
                  child: const Icon(Icons.remove, color: Colors.black),
                  onPressed: () {
                    // L칩gica para hacer zoom out
                    final currentScale = _transformationController.value.getMaxScaleOnAxis();
                    final newScale = (currentScale * 0.8).clamp(_minScale, _maxScale);
                    final zoomedMatrix = Matrix4.identity()
                      ..translate(context.size!.width / 2, context.size!.height / 2)
                      ..scale(newScale)
                      ..translate(-context.size!.width / 2, -context.size!.height / 2);

                    _transformationController.value = zoomedMatrix;
                  },
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
lib/presentation/screens/favorites_page.dart
--- File: lib/presentation/screens/favorites_page.dart ---
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

// Favoritos (pedidos guardados)
class FavoritesPage extends StatelessWidget {
  final List<String> favorites = [
    '12 Donuts + 6 Cervezas + Nachos Gigantes',
    '20 Duff Light',
  ];

  FavoritesPage({super.key});

  @override
  Widget build(BuildContext context) {
    return ListView.separated(
      padding: EdgeInsets.all(16),
      itemCount: favorites.length,
      separatorBuilder: (_, __) => SizedBox(height: 12),
      itemBuilder: (context, index) {
        return Card(
          color: Colors.brown[200],
          child: Padding(
            padding: const EdgeInsets.all(16.0),
            child: Text(
              favorites[index],
              style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
            ),
          ),
        );
      },
    );
  }
}

lib/presentation/screens/beer_menu_screen.dart
--- File: lib/presentation/screens/beer_menu_screen.dart ---
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../blocs/cart/cart_bloc.dart';
import '../blocs/cart/cart_event.dart';
import '../blocs/cart/cart_state.dart';
import '../../domain/entities/beer.dart';

class BeerMenuScreen extends StatelessWidget {
  const BeerMenuScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<CartBloc, CartState>(
      builder: (context, state) {
        if (state is CartLoading) {
          return const Center(child: CircularProgressIndicator(color: Colors.brown));
        }
        if (state is CartLoaded) {
          return LayoutBuilder(
            builder: (context, constraints) {
              final isWide = constraints.maxWidth > 600;
              final crossAxisCount = isWide ? 2 : 1;
              return GridView.builder(
                padding: const EdgeInsets.all(16),
                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: crossAxisCount,
                  crossAxisSpacing: 16,
                  mainAxisSpacing: 16,
                  childAspectRatio: isWide ? 1.2 : 1.0,
                ),
                itemCount: state.catalog.length,
                itemBuilder: (context, index) {
                  final productFromCatalog = state.catalog[index];
                  
                  final cartItem = state.cartItems.firstWhere(
                    (item) => item.name == productFromCatalog.name,
                    orElse: () => productFromCatalog.copyWith(quantity: 0),
                  );

                  return AnimatedSwitcher(
                    duration: const Duration(milliseconds: 300),
                    transitionBuilder: (child, animation) {
                      return FadeTransition(opacity: animation, child: child);
                    },
                    child: cartItem.quantity == 0
                        ? _buildInitialCard(context, productFromCatalog)
                        : _buildActiveCard(context, cartItem),
                  );
                },
              );
            },
          );
        }
        if (state is CartError) {
          return Center(child: Text(state.message));
        }
        return const Center(child: Text('Algo sali칩 mal.'));
      },
    );
  }

  void _showHomerFeedback(BuildContext context, String message) {
    ScaffoldMessenger.of(context).hideCurrentSnackBar();
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(
          message,
          style: const TextStyle(fontWeight: FontWeight.bold, color: Colors.black),
        ),
        backgroundColor: Colors.yellow[700],
        behavior: SnackBarBehavior.floating,
      ),
    );
  }

  Widget _buildInitialCard(BuildContext context, Beer beer) {
    return Card(
      key: ValueKey('${beer.name}_initial'),
      color: Colors.yellow[100],
      clipBehavior: Clip.antiAlias,
      elevation: 4,
      child: InkWell(
        onTap: () => context.read<CartBloc>().add(CartItemAdded(beer)),
        child: Column(
          children: [
            Expanded(
              child: Image.network(
                beer.image,
                fit: BoxFit.cover,
                width: double.infinity,
                // Muestra un indicador de carga mientras la imagen se descarga
                loadingBuilder: (context, child, loadingProgress) {
                  if (loadingProgress == null) return child;
                  return const Center(
                    child: CircularProgressIndicator(
                      color: Colors.brown,
                    ),
                  );
                },
                // Muestra un icono si hay un error al cargar la imagen
                errorBuilder: (context, error, stackTrace) {
                  return const Icon(Icons.no_photography, color: Colors.red, size: 50);
                },
              ),
            ),
            Padding(
              padding: EdgeInsets.all(12.0),
              child: Text(
                beer.name,
                style: TextStyle(fontWeight: FontWeight.bold, fontSize: 18),
                textAlign: TextAlign.center,
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildActiveCard(BuildContext context, Beer beer) {
    return Card(
      key: ValueKey('${beer.name}_active'),
      color: Colors.yellow[100],
      clipBehavior: Clip.antiAlias,
      elevation: 8,
      child: Stack(
        children: [
          Column(
            children: [
              Expanded(
                child: Image.network(
                  beer.image,
                  fit: BoxFit.cover,
                  width: double.infinity,
                  loadingBuilder: (context, child, loadingProgress) {
                    if (loadingProgress == null) return child;
                    return const Center(
                      child: CircularProgressIndicator(
                        color: Colors.brown,
                      ),
                    );
                  },
                  errorBuilder: (context, error, stackTrace) {
                    return const Icon(Icons.no_photography, color: Colors.red, size: 50);
                  },
                ),
              ),
              const SizedBox(height: 60),
            ],
          ),
          Positioned(
            bottom: 0,
            left: 0,
            right: 0,
            child: Container(
              color: Colors.black.withOpacity(0.6),
              padding: const EdgeInsets.symmetric(horizontal: 8.0, vertical: 4.0),
              child: Column(
                children: [
                  Text(
                    beer.name,
                    style: const TextStyle(
                      fontWeight: FontWeight.bold,
                      fontSize: 18,
                      color: Colors.white,
                    ),
                    textAlign: TextAlign.center,
                  ),
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                    children: [
                      IconButton(
                        icon: const Icon(Icons.remove_circle, color: Colors.white, size: 30),
                        onPressed: () => context.read<CartBloc>().add(CartItemRemoved(beer)),
                      ),
                      Stack(
                        children: <Widget>[
                          Text(
                            beer.quantity.toString(),
                            style: TextStyle(
                              fontSize: 28,
                              fontWeight: FontWeight.bold,
                              foreground: Paint()
                                ..style = PaintingStyle.stroke
                                ..strokeWidth = 2.5
                                ..color = Colors.black,
                            ),
                          ),
                          Text(
                            beer.quantity.toString(),
                            style: const TextStyle(
                              fontSize: 28,
                              fontWeight: FontWeight.bold,
                              color: Colors.yellow,
                            ),
                          ),
                        ],
                      ),
                      IconButton(
                        icon: const Icon(Icons.add_circle, color: Colors.white, size: 30),
                        onPressed: () {
                          if (beer.quantity < 20) {
                            context.read<CartBloc>().add(CartItemAdded(beer));
                          } else {
                            _showHomerFeedback(context, "춰Woo-hoo! 춰Suficiente por ahora!");
                          }
                        },
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}
lib/presentation/blocs/beer_counter/beer_counter_event.dart
--- File: lib/presentation/blocs/beer_counter/beer_counter_event.dart ---
import 'package:equatable/equatable.dart';

abstract class BeerCounterEvent extends Equatable {
  const BeerCounterEvent();

  @override
  List<Object> get props => [];
}

class BeerCounterToggled extends BeerCounterEvent {
  final bool isActive;
  const BeerCounterToggled(this.isActive);

  @override
  List<Object> get props => [isActive];
}

class BeerCounterIncremented extends BeerCounterEvent {}

lib/presentation/blocs/beer_counter/beer_counter_state.dart
--- File: lib/presentation/blocs/beer_counter/beer_counter_state.dart ---
import 'package:equatable/equatable.dart';

class BeerCounterState extends Equatable {
  final int beerCount;
  final bool isActive;
  final bool showHomerAlert; // <-- NUEVA PROPIEDAD

  const BeerCounterState({
    this.beerCount = 0,
    this.isActive = false,
    this.showHomerAlert = false, // <-- VALOR POR DEFECTO
  });

  BeerCounterState copyWith({
    int? beerCount,
    bool? isActive,
    bool? showHomerAlert,
  }) {
    return BeerCounterState(
      beerCount: beerCount ?? this.beerCount,
      isActive: isActive ?? this.isActive,
      showHomerAlert: showHomerAlert ?? this.showHomerAlert,
    );
  }

  @override
  List<Object> get props => [beerCount, isActive, showHomerAlert];
}
lib/presentation/blocs/beer_counter/beer_counter_bloc.dart
--- File: lib/presentation/blocs/beer_counter/beer_counter_bloc.dart ---
import 'package:flutter_bloc/flutter_bloc.dart';
import 'beer_counter_event.dart';
import 'beer_counter_state.dart';

class BeerCounterBloc extends Bloc<BeerCounterEvent, BeerCounterState> {
  BeerCounterBloc() : super(const BeerCounterState()) {
    on<BeerCounterToggled>(_onToggled);
    on<BeerCounterIncremented>(_onIncremented);
  }

  void _onToggled(BeerCounterToggled event, Emitter<BeerCounterState> emit) {
    emit(state.copyWith(isActive: event.isActive));
  }

  void _onIncremented(
      BeerCounterIncremented event, Emitter<BeerCounterState> emit) {
    if (!state.isActive) return;

    final newCount = state.beerCount + 1;
    final bool shouldShowAlert = newCount == 21;

    // Emitimos el nuevo estado. Si la alerta se mostr칩, la "reseteamos"
    // en el siguiente estado para que no se vuelva a mostrar en un rebuild.
    emit(state.copyWith(
      beerCount: newCount,
      showHomerAlert: shouldShowAlert,
    ));
  }
}


lib/presentation/blocs/cart/cart_state.dart
--- File: lib/presentation/blocs/cart/cart_state.dart ---
import 'package:equatable/equatable.dart';
import '../../../domain/entities/beer.dart';

abstract class CartState extends Equatable {
  const CartState();

  @override
  List<Object> get props => [];
}

// Estado mientras se carga el cat치logo inicial.
class CartLoading extends CartState {}

// Estado una vez que el cat치logo y el carrito est치n listos.
class CartLoaded extends CartState {
  final List<Beer> catalog;   // Lista completa de productos disponibles.
  final List<Beer> cartItems; // Lista de productos en el carrito.

  const CartLoaded({this.catalog = const [], this.cartItems = const []});

  @override
  List<Object> get props => [catalog, cartItems];
}

// Estado para manejar posibles errores.
class CartError extends CartState {
  final String message;
  const CartError(this.message);

  @override
  List<Object> get props => [message];
}
lib/presentation/blocs/cart/cart_event.dart
--- File: lib/presentation/blocs/cart/cart_event.dart ---
import 'package:equatable/equatable.dart';
import '../../../domain/entities/beer.dart';

abstract class CartEvent extends Equatable {
  const CartEvent();

  @override
  List<Object> get props => [];
}

// Evento para solicitar la carga del cat치logo de productos.
class CartProductsLoaded extends CartEvent {}

// Evento para a침adir o incrementar un producto en el carrito.
class CartItemAdded extends CartEvent {
  final Beer beer;
  const CartItemAdded(this.beer);

  @override
  List<Object> get props => [beer];
}

// Evento para quitar o decrementar un producto del carrito.
class CartItemRemoved extends CartEvent {
  final Beer beer;
  const CartItemRemoved(this.beer);

  @override
  List<Object> get props => [beer];
}
lib/presentation/blocs/cart/cart_bloc.dart
--- File: lib/presentation/blocs/cart/cart_bloc.dart ---
import 'package:flutter_bloc/flutter_bloc.dart';
import '../../../domain/entities/beer.dart';
import '../../../domain/repositories/beer_repository.dart';
import 'cart_event.dart';
import 'cart_state.dart';

class CartBloc extends Bloc<CartEvent, CartState> {
  final BeerRepository _beerRepository;

  CartBloc({required BeerRepository beerRepository})
      : _beerRepository = beerRepository,
        super(CartLoading()) {
    on<CartProductsLoaded>(_onLoadProducts);
    on<CartItemAdded>(_onItemAdded);
    on<CartItemRemoved>(_onItemRemoved);
  }

  Future<void> _onLoadProducts(
      CartProductsLoaded event, Emitter<CartState> emit) async {
    emit(CartLoading());
    try {
      final products = await _beerRepository.getBeerCatalog();
      emit(CartLoaded(catalog: products, cartItems: []));
    } catch (_) {
      emit(const CartError("D'oh! No se pudieron cargar las cervezas."));
    }
  }

  void _onItemAdded(CartItemAdded event, Emitter<CartState> emit) {
    final state = this.state;
    if (state is CartLoaded) {
      final itemIndex =
          state.cartItems.indexWhere((item) => item.id == event.beer.id);
      List<Beer> updatedCart = List.from(state.cartItems);

      if (itemIndex != -1) {
        // El item ya existe, actualizamos la cantidad
        int newQuantity = updatedCart[itemIndex].quantity + 1;
        updatedCart[itemIndex] =
            updatedCart[itemIndex].copyWith(quantity: newQuantity);
      } else {
        // El item es nuevo, lo a침adimos con cantidad 1
        updatedCart.add(event.beer.copyWith(quantity: 1));
      }
      emit(CartLoaded(catalog: state.catalog, cartItems: updatedCart));
    }
  }

  void _onItemRemoved(CartItemRemoved event, Emitter<CartState> emit) {
    final state = this.state;
    if (state is CartLoaded) {
      final itemIndex =
          state.cartItems.indexWhere((item) => item.id == event.beer.id);
      List<Beer> updatedCart = List.from(state.cartItems);

      if (itemIndex != -1 && updatedCart[itemIndex].quantity > 1) {
        int newQuantity = updatedCart[itemIndex].quantity - 1;
        updatedCart[itemIndex] =
            updatedCart[itemIndex].copyWith(quantity: newQuantity);
      } else {
        updatedCart.removeAt(itemIndex);
      }
      emit(CartLoaded(catalog: state.catalog, cartItems: updatedCart));
    }
  }
}
lib/presentation/blocs/orders/orders_event.dart
--- File: lib/presentation/blocs/orders/orders_event.dart ---
import 'package:equatable/equatable.dart';
import '../../../domain/entities/favorite_order.dart';
import '../../../domain/entities/order.dart';

abstract class OrdersEvent extends Equatable {
  const OrdersEvent();
  @override
  List<Object> get props => [];
}

class OrdersLoaded extends OrdersEvent {}

class OrderRepeated extends OrdersEvent {
  final FavoriteOrder favorite;
  const OrderRepeated(this.favorite);
  @override
  List<Object> get props => [favorite];
}

class OrderStatusChanged extends OrdersEvent {
  final String orderId;
  final OrderStatus newStatus;
  const OrderStatusChanged(this.orderId, this.newStatus);
  @override
  List<Object> get props => [orderId, newStatus];
}

lib/presentation/blocs/orders/orders_bloc.dart
--- File: lib/presentation/blocs/orders/orders_bloc.dart ---
import 'dart:math';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../../../domain/entities/order.dart';
import '../../../domain/repositories/order_repository.dart';
import 'orders_event.dart';
import 'orders_state.dart';

class OrdersBloc extends Bloc<OrdersEvent, OrdersState> {
  final OrderRepository _orderRepository;

  OrdersBloc({required OrderRepository orderRepository})
      : _orderRepository = orderRepository,
        super(OrdersLoading()) {
    on<OrdersLoaded>(_onOrdersLoaded);
    on<OrderRepeated>(_onOrderRepeated);
    on<OrderStatusChanged>(_onOrderStatusChanged);
  }

  Future<void> _onOrdersLoaded(
      OrdersLoaded event, Emitter<OrdersState> emit) async {
    emit(OrdersLoading());
    try {
      final favs = await _orderRepository.getFavoriteOrders();
      final active = await _orderRepository.getActiveOrders();
      emit(OrdersLoadSuccess(favoriteOrders: favs, activeOrders: active));
    } catch (_) {
      emit(const OrdersError("D'oh! No se pudieron cargar los pedidos."));
    }
  }

  void _onOrderRepeated(OrderRepeated event, Emitter<OrdersState> emit) {
    if (state is OrdersLoadSuccess) {
      final currentState = state as OrdersLoadSuccess;
      final newOrder = Order(
        id: 'ORD-${Random().nextInt(900) + 100}', // ID aleatorio
        items: event.favorite.items,
        date: DateTime.now(),
        status: OrderStatus.enProceso,
      );

      final updatedActiveOrders = List<Order>.from(currentState.activeOrders)
        ..insert(0, newOrder);

      emit(OrdersLoadSuccess(
        favoriteOrders: currentState.favoriteOrders,
        activeOrders: updatedActiveOrders,
      ));
    }
  }

  void _onOrderStatusChanged(
      OrderStatusChanged event, Emitter<OrdersState> emit) {
    if (state is OrdersLoadSuccess) {
      final currentState = state as OrdersLoadSuccess;
      final updatedOrders = currentState.activeOrders.map((order) {
        return order.id == event.orderId
            ? Order(id: order.id, items: order.items, date: order.date, status: event.newStatus)
            : order;
      }).toList();

      emit(OrdersLoadSuccess(
          favoriteOrders: currentState.favoriteOrders,
          activeOrders: updatedOrders));
    }
  }
}

lib/presentation/blocs/orders/orders_state.dart
--- File: lib/presentation/blocs/orders/orders_state.dart ---
import 'package:equatable/equatable.dart';
import '../../../domain/entities/favorite_order.dart';
import '../../../domain/entities/order.dart';

abstract class OrdersState extends Equatable {
  const OrdersState();
  @override
  List<Object> get props => [];
}

class OrdersLoading extends OrdersState {}

class OrdersLoadSuccess extends OrdersState {
  final List<FavoriteOrder> favoriteOrders;
  final List<Order> activeOrders;

  const OrdersLoadSuccess({
    this.favoriteOrders = const [],
    this.activeOrders = const [],
  });

  @override
  List<Object> get props => [favoriteOrders, activeOrders];
}

class OrdersError extends OrdersState {
  final String message;
  const OrdersError(this.message);
  @override
  List<Object> get props => [message];
}

lib/presentation/services/notification_service.dart
--- File: lib/presentation/services/notification_service.dart ---
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:timezone/data/latest.dart' as tz;
import 'package:timezone/timezone.dart' as tz;

class NotificationService {
  // Hacemos la clase un Singleton para tener una 칰nica instancia en toda la app.
  static final NotificationService _notificationService = NotificationService._internal();
  factory NotificationService() {
    return _notificationService;
  }
  NotificationService._internal();

  final FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin =
      FlutterLocalNotificationsPlugin();

  Future<void> init() async {
    // 1. Configuraci칩n de inicializaci칩n para Android
    const AndroidInitializationSettings initializationSettingsAndroid =
        AndroidInitializationSettings('@mipmap/ic_launcher'); // Usa el icono de tu app

    // 2. Configuraci칩n de inicializaci칩n para iOS
    const DarwinInitializationSettings initializationSettingsIOS =
        DarwinInitializationSettings(
      requestSoundPermission: true,
      requestBadgePermission: true,
      requestAlertPermission: true,
    );

    // 3. Juntamos las configuraciones
    const InitializationSettings initializationSettings = InitializationSettings(
      android: initializationSettingsAndroid,
      iOS: initializationSettingsIOS,
    );

    // 4. Inicializamos el plugin y la configuraci칩n de zonas horarias
    await flutterLocalNotificationsPlugin.initialize(initializationSettings);
    tz.initializeTimeZones();
  }

  // M칠todo para programar notificaciones peri칩dicas
  Future<void> scheduleHourlyWaterReminder() async {
    // Pide permiso para notificaciones en Android 13+
    await flutterLocalNotificationsPlugin
        .resolvePlatformSpecificImplementation<
            AndroidFlutterLocalNotificationsPlugin>()
        ?.requestNotificationsPermission();

    // Detalles de la notificaci칩n
    const AndroidNotificationDetails androidNotificationDetails =
        AndroidNotificationDetails(
      'water_reminder_channel', // ID del canal
      'Recordatorio de Agua',   // Nombre del canal
      channelDescription: 'Canal para recordatorios de beber agua.',
      importance: Importance.max,
      priority: Priority.high,
    );
    const NotificationDetails notificationDetails =
        NotificationDetails(android: androidNotificationDetails);

    // Programamos la notificaci칩n para que se repita cada hora
    await flutterLocalNotificationsPlugin.periodicallyShow(
      0, // ID de la notificaci칩n
      "춰Hora de hidratarse!",
      "Mmm... ag칲ita. 춰Bebe un vaso de agua!",
      RepeatInterval.everyMinute, // 춰Se repite cada hora!
      notificationDetails,
      androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle, // <-- 춰Este es el cambio!
    );
  }

  // M칠todo para cancelar todas las notificaciones
  Future<void> cancelAllNotifications() async {
    await flutterLocalNotificationsPlugin.cancelAll();
  }
}
lib/presentation/services/settings_service.dart
--- File: lib/presentation/services/settings_service.dart ---
import 'package:shared_preferences/shared_preferences.dart';

class SettingsService {
  static const _waterReminderKey = 'water_reminder_active';

  // Guarda el estado del recordatorio de agua
  Future<void> setWaterReminder(bool isActive) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setBool(_waterReminderKey, isActive);
  }

  // Lee el estado del recordatorio de agua
  Future<bool> getWaterReminder() async {
    final prefs = await SharedPreferences.getInstance();
    // Devuelve el valor guardado, o 'false' si nunca se ha guardado nada.
    return prefs.getBool(_waterReminderKey) ?? false;
  }
}
lib/data/models/beer_model.dart
--- File: lib/data/models/beer_model.dart ---
import 'package:cloud_firestore/cloud_firestore.dart';
import '../../domain/entities/beer.dart';

class BeerModel extends Beer {
  const BeerModel({
    required super.id,
    required super.name,
    required super.price,
    required super.image,
    super.quantity,
  });

  // Factory constructor para crear una instancia de BeerModel desde un documento de Firestore
  factory BeerModel.fromSnapshot(DocumentSnapshot snapshot) {
    final data = snapshot.data() as Map<String, dynamic>;
    return BeerModel(
      id: snapshot.id, // Es buena pr치ctica usar el ID del documento de Firestore.
      name: data['name'],
      image: data['image'],
      price: (data['price'] as num).toDouble(), // Aseguramos que sea double.
      quantity: data['quantity'] ?? 0, // Valor por defecto si no existe.
    );
  }
}

lib/data/repositories/order_repository_impl.dart
--- File: lib/data/repositories/order_repository_impl.dart ---
import '../../domain/entities/beer.dart';
import '../../domain/entities/favorite_order.dart';
import '../../domain/entities/order.dart';
import '../../domain/repositories/order_repository.dart';

class MockOrderRepository implements OrderRepository {
  @override
  Future<List<FavoriteOrder>> getFavoriteOrders() async {
    // Simulamos una llamada a una API
    await Future.delayed(const Duration(milliseconds: 800));
    return const [
      FavoriteOrder(id: 1, items: [
        Beer(id: '1', name: 'Duff', price: 1.50, image: 'assets/duff.png', quantity: 6),
        Beer(id: '2', name: 'Duff Lite', price: 1.25, image: 'assets/duff_lite.png', quantity: 6),
      ]),
      FavoriteOrder(id: 2, items: [
        Beer(id: '3', name: 'Duff Dry', price: 1.75, image: 'assets/duff_dry.png', quantity: 12),
      ]),
    ];
  }

  @override
  Future<List<Order>> getActiveOrders() async {
    // Simulamos otra llamada a una API
    await Future.delayed(const Duration(milliseconds: 1200));
    return [
      Order(
        id: 'ORD-001',
        items: const [
          Beer(id: '1', name: 'Duff', price: 1.50, image: 'assets/duff.png', quantity: 2),
        ],
        date: DateTime.now().subtract(const Duration(minutes: 15)),
        status: OrderStatus.enProceso,
      ),
      Order(
        id: 'ORD-002',
        items: const [
          Beer(id: '4', name: 'Fudd', price: 1.0, image: 'assets/fudd.png', quantity: 4),
        ],
        date: DateTime.now().subtract(const Duration(hours: 1)),
        status: OrderStatus.llegando,
      ),
    ];
  }
}

lib/data/repositories/beer_repository_impl.dart
--- File: lib/data/repositories/beer_repository_impl.dart ---
import 'package:proyecto_homero/domain/entities/beer.dart';
import 'package:proyecto_homero/domain/repositories/beer_repository.dart';
import '../datasources/beer_remote_datasource.dart';

// 춰F칤jate c칩mo ahora implementa la clase abstracta del dominio!
class BeerRepositoryImpl implements BeerRepository {
  final BeerRemoteDataSource remoteDataSource;

  BeerRepositoryImpl({required this.remoteDataSource});

  // El m칠todo getBeerCatalog ahora es una implementaci칩n del contrato.
  @override
  Future<List<Beer>> getBeerCatalog() async {
    // Ahora delega la llamada al DataSource
    return await remoteDataSource.getBeers();
  }
}

lib/data/datasources/beer_remote_datasource.dart
--- File: lib/data/datasources/beer_remote_datasource.dart ---
import 'package:cloud_firestore/cloud_firestore.dart';
import '../models/beer_model.dart';

abstract class BeerRemoteDataSource {
  Future<List<BeerModel>> getBeers();
}

class BeerRemoteDataSourceImpl implements BeerRemoteDataSource {
  final FirebaseFirestore firestore;

  BeerRemoteDataSourceImpl({required this.firestore});

  @override
  Future<List<BeerModel>> getBeers() async {
    final snapshot = await firestore.collection('beers').get();
    return snapshot.docs.map((doc) => BeerModel.fromSnapshot(doc)).toList();
  }
}

lib/domain/entities/beer.dart
--- File: lib/domain/entities/beer.dart ---
import 'package:equatable/equatable.dart';

class Beer extends Equatable {
  final String id; // <-- CAMBIO: A침adido
  final String name;
  final double price;
  final String image;
  final int quantity;

  const Beer({
    required this.id, // <-- CAMBIO: A침adido
    required this.name,
    required this.price,
    required this.image,
    this.quantity = 0,
  });

  Beer copyWith({
    String? id,
    String? name,
    double? price,
    String? image,
    int? quantity,
  }) {
    return Beer(
      id: id ?? this.id,
      name: name ?? this.name,
      price: price ?? this.price,
      image: image ?? this.image,
      quantity: quantity ?? this.quantity,
    );
  }

  @override
  List<Object?> get props => [id, name, price, image, quantity];
}

lib/domain/entities/favorite_order.dart
--- File: lib/domain/entities/favorite_order.dart ---
import 'package:equatable/equatable.dart';
import 'beer.dart';

class FavoriteOrder extends Equatable {
  final int id;
  final List<Beer> items;

  const FavoriteOrder({
    required this.id,
    required this.items,
  });

  int get totalItems => items.fold(0, (sum, item) => sum + item.quantity);

  @override
  List<Object?> get props => [id, items];
}

lib/domain/entities/order.dart
--- File: lib/domain/entities/order.dart ---
import 'package:equatable/equatable.dart';
import 'beer.dart';

enum OrderStatus { enProceso, llegando, cancelado, entregado }

class Order extends Equatable {
  final String id;
  final List<Beer> items;
  final DateTime date;
  final OrderStatus status;

  const Order({
    required this.id,
    required this.items,
    required this.date,
    required this.status,
  });

  int get totalItems => items.fold(0, (sum, item) => sum + item.quantity);

  String get statusText {
    switch (status) {
      case OrderStatus.enProceso: return 'En proceso';
      case OrderStatus.llegando: return 'Llegando';
      case OrderStatus.cancelado: return 'Cancelado';
      case OrderStatus.entregado: return 'Entregado';
    }
  }

  @override
  List<Object?> get props => [id, items, date, status];
}

lib/domain/repositories/beer_repository.dart
--- File: lib/domain/repositories/beer_repository.dart ---
// lib/domain/repositories/beer_repository.dart

import 'package:proyecto_homero/domain/entities/beer.dart';

abstract class BeerRepository {
  Future<List<Beer>> getBeerCatalog();
}

lib/domain/repositories/order_repository.dart
--- File: lib/domain/repositories/order_repository.dart ---
import '../entities/favorite_order.dart';
import '../entities/order.dart';

abstract class OrderRepository {
  Future<List<FavoriteOrder>> getFavoriteOrders();
  Future<List<Order>> getActiveOrders();
}

--- File: pubspec.yaml ---
name: proyecto_homero
description: "A new Flutter project."
# The following line prevents the package from being accidentally published to
# pub.dev using `flutter pub publish`. This is preferred for private packages.
publish_to: "none" # Remove this line if you wish to publish to pub.dev

# The following defines the version and build number for your application.
# A version number is three numbers separated by dots, like 1.2.43
# followed by an optional build number separated by a +.
# Both the version and the builder number may be overridden in flutter
# build by specifying --build-name and --build-number, respectively.
# In Android, build-name is used as versionName while build-number used as versionCode.
# Read more about Android versioning at https://developer.android.com/studio/publish/versioning
# In iOS, build-name is used as CFBundleShortVersionString while build-number is used as CFBundleVersion.
# Read more about iOS versioning at
# https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html
# In Windows, build-name is used as the major, minor, and patch parts
# of the product and file versions while build-number is used as the build suffix.
version: 1.0.0+1

environment:
  sdk: ^3.9.0

# Dependencies specify other packages that your package needs in order to work.
# To automatically upgrade your package dependencies to the latest versions
# consider running `flutter pub upgrade --major-versions`. Alternatively,
# dependencies can be manually updated by changing the version numbers below to
# the latest version available on pub.dev. To see which dependencies have newer
# versions available, run `flutter pub outdated`.
dependencies:
  flutter:
    sdk: flutter
  flutter_bloc: ^8.1.6    # 칔ltima versi칩n estable
  equatable: ^2.0.5       # Para comparar eventos y estados f치cilmente
  # The following adds the Cupertino Icons font to your application.
  firebase_core: ^3.2.0
  # Use with the CupertinoIcons class for iOS style icons.
  cupertino_icons: ^1.0.8
  audioplayers: ^6.0.0  # <-- para agregar audios o sonidos
  cloud_firestore: ^5.6.12
  flutter_local_notifications: ^19.5.0
  timezone: ^0.10.1
  shared_preferences: ^2.2.4
  intl: ^0.18.1
dev_dependencies:
  flutter_test:
    sdk: flutter

  # The "flutter_lints" package below contains a set of recommended lints to
  # encourage good coding practices. The lint set provided by the package is
  # activated in the `analysis_options.yaml` file located at the root of your
  # package. See that file for information about deactivating specific lint
  # rules and activating additional ones.
  flutter_lints: ^5.0.0

# For information on the generic Dart part of this file, see the
# following page: https://dart.dev/tools/pub/pubspec

# The following section is specific to Flutter packages.
flutter:
  assets:
    - assets/taberna.jpg
    - assets/duff_normal.png
    - assets/duff_dry.png
    - assets/duff_light.png
    - assets/duff_christmas.png
    - assets/marge.png
    - assets/mapa_springfield.jpg
    - assets/sounds/marge.mp3

  # The following line ensures that the Material Icons font is
  # included with your application, so that you can use the icons in
  # the material Icons class.
  uses-material-design: true

  # To add assets to your application, add an assets section, like this:
  # assets:
  #   - images/a_dot_burr.jpeg
  #   - images/a_dot_ham.jpeg

  # An image asset can refer to one or more resolution-specific "variants", see
  # https://flutter.dev/to/resolution-aware-images

  # For details regarding adding assets from package dependencies, see
  # https://flutter.dev/to/asset-from-package

  # To add custom fonts to your application, add a fonts section here,
  # in this "flutter" section. Each entry in this list should have a
  # "family" key with the font family name, and a "fonts" key with a
  # list giving the asset and other descriptors for the font. For
  # example:
  # fonts:
  #   - family: Schyler
  #     fonts:
  #       - asset: fonts/Schyler-Regular.ttf
  #       - asset: fonts/Schyler-Italic.ttf
  #         style: italic
  #   - family: Trajan Pro
  #     fonts:
  #       - asset: fonts/TrajanPro.ttf
  #       - asset: fonts/TrajanPro_Bold.ttf
  #         weight: 700
  #
  # For details regarding fonts from package dependencies,
  # see https://flutter.dev/to/font-from-package
